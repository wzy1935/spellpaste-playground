需求1 主窗口

快捷键按下后，需调用复制并窗口呼出；选择spell后会自动退出并使焦点返回原窗口并调用粘贴

---

## Playground 实现记录

**位置：** `playground/`

**快捷键：** `Ctrl+Space`

### 实现方案

| 功能 | 方案 | 相关代码 |
|------|------|---------|
| 全局快捷键 | `tauri-plugin-global-shortcut` | `lib.rs` setup |
| 模拟复制（macOS） | `CGEventCreateKeyboardEvent` + `kCGEventSourceStatePrivate` | `lib.rs: macos::simulate_copy_private_source` |
| 模拟复制（Windows） | `enigo 0.2` | `lib.rs` |
| 模拟粘贴 | `enigo 0.2`（Cmd+V / Ctrl+V） | `lib.rs: simulate_paste` |
| 保存/恢复焦点窗口（macOS） | `NSWorkspace.frontmostApplication` PID + `NSRunningApplication.activate` | `lib.rs: macos` |
| 保存/恢复焦点窗口（Windows） | `winapi::GetForegroundWindow` / `SetForegroundWindow` | `lib.rs` |
| 窗口呼出/隐藏 | Tauri `window.show()` / `window.hide()` | `lib.rs: apply_spell` |

### 触发流程

```
Ctrl+Space 按下
  → 保存原窗口（macOS: PID，Windows: HWND）
  → 模拟复制（macOS: CGEvent private source，Windows: enigo Ctrl+C）
  → sleep 100ms（等待剪贴板更新）
  → window.show() + set_focus()

用户点击 Apply Spell
  → window.hide()
  → 恢复焦点到原窗口
  → sleep 50ms（等待焦点切换）
  → 模拟 Cmd+V / Ctrl+V
```

### 踩坑记录

**macOS 焦点恢复**
- `SetForegroundWindow` 是 Windows API，macOS 需要用 `NSRunningApplication.activateWithOptions:`
- 保存的是进程 PID，而非窗口句柄

**macOS 复制修饰键污染**
- 根本原因：`Ctrl+Space` 触发时 Ctrl 键物理上仍被按住；`enigo` 使用 `kCGEventSourceStateCombinedSessionState`，会继承当前物理按键状态，导致发出的是 `Ctrl+Cmd+C` 而非 `Cmd+C`
- 解决方案：绕过 enigo，直接用 `CGEventCreateKeyboardEvent` + `kCGEventSourceStatePrivate` 创建事件，该 source 从干净状态出发，不继承任何物理按键状态

### 窗口配置

- `visible: false` — 默认隐藏
- `decorations: false` — 无标题栏
- `alwaysOnTop: true` — 始终置顶
- `skipTaskbar: true` — 不在任务栏显示
- `center: true` — 居中弹出
- 尺寸：600 × 80

### 待验证（手动测试）

- [ ] 快捷键在各类 app 中均可触发（浏览器、原生、Electron）
- [ ] 剪贴板内容正确复制
- [ ] 焦点正确返回原窗口后粘贴生效
- [ ] `Ctrl+Space` 是否与系统/其他 app 快捷键冲突